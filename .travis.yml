language: java
sudo: false
install: true

addons:
  postgresql: "10"
  apt:
    packages:
      - postgresql-10
      - postgresql-client-10
  sonarcloud:
    organization: "felberto-github"
    token:
      secure: ${SONAR_TOKEN}
env:
  global:
    - PGPORT=5433

jdk:
  - openjdk11

services:
  - postgresql

before_script:
  - psql -c 'create database coubi;' -U postgres
  - psql -c "create user coubi with password 'coubi';" -U postgres

jobs:
  include:
    - stage: sonar
      script:
        # JaCoCo is used to have code coverage, the agent has to be activated
        - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent org.jacoco:jacoco-maven-plugin:report package sonar:sonar

