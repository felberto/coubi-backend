language: java
sudo: false
install: true

addons:
  postgresql: "10"
  apt:
    packages:
      - postgresql-10
      - postgresql-client-10
  sonarcloud:
    organization: "felberto-github"
    token:
      secure: ${SONAR_TOKEN}
env:
  global:
    - PGPORT=5433

jdk:
  - openjdk11

before_script:
  - psql -c "CREATE DATABASE coubi;" -U postgres
  - psql -c "CREATE USER coubi WITH PASSWORD 'coubi';" -U postgres

jobs:
  include:
    - stage: sonar
      script:
        # JaCoCo is used to have code coverage, the agent has to be activated
        - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent org.jacoco:jacoco-maven-plugin:report package sonar:sonar

